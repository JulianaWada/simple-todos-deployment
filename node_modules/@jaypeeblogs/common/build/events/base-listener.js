"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.BaseListener = void 0;
class BaseListener {
    constructor(nats) {
        this.ackWait = 30 * 1000;
        this._client = nats;
    }
    subscriptionOptions() {
        const options = this._client.subscriptionOptions()
            .setDeliverAllAvailable()
            .setManualAckMode(true)
            .setDurableName(this.queuegroup)
            .setAckWait(this.ackWait);
        return options;
    }
    parseData(msg) {
        const data = msg.getData();
        return typeof data === "string" ?
            JSON.parse(data) :
            JSON.parse(data.toString('utf-8'));
    }
    listen() {
        const subscription = this._client.subscribe(this.subject, this.queuegroup, this.subscriptionOptions());
        console.log(`subscribed to the subject: ${this.subject}`);
        subscription.on('message', (msg) => {
            const data = this.parseData(msg);
            this.onMessage(data, msg);
        });
    }
    ;
}
exports.BaseListener = BaseListener;
